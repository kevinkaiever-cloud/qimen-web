/**
 * 奇门遁甲知识库 - 用于内置 AI 问答
 * 涵盖八神、八门、九星、用神取法、断事法则等核心知识
 * 断事逻辑来自雨霖课程字幕整理，保证解读时按步骤、按逻辑输出
 */
const { getDuanshiLogicPrompt } = require('./duanshi-logic');

const QIMEN_KNOWLEDGE = `
## 一、奇门遁甲四盘体系
奇门遁甲按九宫八卦分为四层：
- 九星：天盘，代表天时、先天秉性
- 八门：人盘，代表人事、人和
- 九宫：地盘，代表地利、方位
- 八神：神盘，代表神助、玄机

## 二、八神（直符、腾蛇、太阴、六合、勾陈/白虎、朱雀/玄武、九地、九天）
值符：贵神，大吉，主贵人、领导、权威
腾蛇：虚诈，主变化、缠绕、口舌是非
太阴：阴私，主暗中、策划、女性贵人
六合：和合，主合作、婚姻、喜庆
勾陈（阳遁）/白虎（阴遁）：凶神，主争斗、伤灾
朱雀（阳遁）/玄武（阴遁）：口舌、盗贼、小人
九地：稳重、潜藏，主静守、缓慢
九天：张扬、高远，主主动、快速

## 三、八门（休、生、伤、杜、景、死、惊、开）
三吉门：开门（乾）、休门（坎）、生门（艮）— 宜求财、谋事、出行
三凶门：死门（坤）、惊门（兑）、伤门（震）— 多主不利
平门：杜门（巽）、景门（离）— 中平，视情况而定
口诀：吉门被克吉不就，凶门被克无灾殃；吉门相生主大利，凶门得生祸难当

## 四、九星（天蓬、天任、天冲、天辅、天英、天芮、天柱、天心、天禽）
三吉星：天心、天任、天辅
三凶星：天蓬、天芮、天柱
中平星：天禽、天英、天冲

## 五、九宫八卦
1坎、2坤、3震、4巽、5中、6乾、7兑、8艮、9离
宫位对应：坎北、离南、震东、兑西、艮东北、巽东南、坤西南、乾西北

## 六、用神取法（问事对应）
- 问财：看生门、戊、己、天乙（生我之干）
- 问官/工作：看开门、杜门、年干、值符
- 问婚姻感情：看六合、乙（妻）、庚（夫）、休门
- 问疾病：看天芮、死门、伤门、时干
- 问学业考试：看天辅、景门、丁奇
- 问出行：看九天、九地、开门、休门
- 问官司：看惊门、天柱、庚
- 问房产/风水：看生门、死门、时干宫

## 七、旺相休囚死（五行旺衰）
旺：得令最强；相：得生次之；休：生他减退；囚：克他无力；死：被克最弱
需结合节令（春木旺、夏火旺、秋金旺、冬水旺、四季土旺）判断门星神旺衰

## 八、生克关系
五行生克：金生水、水生木、木生火、火生土、土生金；金克木、木克土、土克水、水克火、火克金
宫与宫：看落宫五行；门与门、星与星同理
断事要综合：用神落宫 + 与相关宫的生克 + 门星神吉凶 + 旺衰

## 九、值符与值使
值符：九星之首，旬首所在之星，代表当前局的主导力量
值使：值符所在宫对应的八门，代表当前局的主要矛盾或切入点
解读时先看值符值使落宫，再结合用神

## 十、单宫分析·解卦思路（符号分层法）
单宫分析考验基本功，在初步判断时可利用「符号分层」快速理解盘面：
- **神** → **性质**：八神定该宫整体性质（吉凶倾向、玄机所在）
- **门** ← 心态、**星** ← 环境：门看人事心态，星看天时环境
- **门** → **干** → **现状**：门与干联动，反映当前状态
- **星** → **干** → **背景**：星与干联动，反映背后成因
- **干** → **趋势**：天干落宫指示发展方向
解读时：先看神定性质，再观门星与干的关系，最后综合现状、背景、趋势得出结论

## 十一、断事基本原则
1. 一盘一事：一次只问一件事，问什么取什么用神
2. 用神为主：找准与问题对应的用神（门、星、神、干）
3. 看落宫：用神落在何宫，该宫吉凶、旺衰、与其他宫关系
4. 生克综合：用神宫与相关宫的生克决定顺逆
5. 吉凶叠加：吉门吉星吉神+旺相为大利；凶门凶星凶神+得生为祸难当
6. 时空结合：考虑问事时间（节令）与地点（若涉及方位）
7. 单宫分层：神→性质；门+干→现状；星+干→背景；干→趋势
`;

// 断事逻辑（从字幕提炼，解读时必须按此顺序与规则执行）
const DUANSHI_LOGIC_BLOCK = getDuanshiLogicPrompt();

/**
 * 获取用于 LLM 的系统提示词（含奇门知识）
 */
function getKnowledgeSystemPrompt() {
  return `你是一位精通奇门遁甲的宗师级专家，深谙传统术数理论。请基于以下知识库与断事逻辑严谨、专业地回答用户关于奇门遁甲的问题。

${QIMEN_KNOWLEDGE}

${DUANSHI_LOGIC_BLOCK}

回答要求：
1. 以知识库与上述断事逻辑为本，解读时必须按「坐标定位→定人定事→生克→门星神→旺衰」顺序展开，言之有据
2. 单宫采用符号分层法：神→性质，门+干→现状，星+干→背景，干→趋势
3. 用通俗语言解释专业术语，便于普通人理解
4. 涉及具体断事时，先给出结论倾向（成/不成、顺/逆），再分层简述理由，最后用 1～2 句总结
5. 对超出知识库范围的问题，诚实说明并给出可参考方向
6. 保持中立客观，不夸大玄学功效，不承诺具体结果`;
}

module.exports = {
  QIMEN_KNOWLEDGE,
  getKnowledgeSystemPrompt
};
